!function(e,t,a,i){"use strict";t.requestAnimationFrame||(t.requestAnimationFrame=t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e,a){t.setTimeout(e,1e3/60)});var o,n=function(){};e.qrCodeReader={jsQRpath:"../dist/js/jsQR/jsQR.min.js",beepPath:"../dist/audio/beep.mp3",instance:null,defaults:{multiple:!1,qrcodeRegexp:/./,audioFeedback:!0,repeatTimeout:1500,target:null,skipDuplicates:!0,lineColor:"#FF3B58",callback:function(e){}}},n.prototype={constructor:n,init:function(){o.buildHTML(),o.scriptLoaded=!1,o.isOpen=!1,e.getScript(e.qrCodeReader.jsQRpath,(function(e,t,a){200==a.status?o.scriptLoaded=!0:console.error("Error loading QRCode parser script")}))},buildHTML:function(){o.bgOverlay=e('<div id="qrr-overlay"></div>'),o.container=e('<div id="qrr-container"></div>'),o.closeBtn=e('<span id="qrr-close">&times;</span>'),o.closeBtn.appendTo(o.container),o.okBtn=e('<a id="qrr-ok">OK</a>'),o.loadingMessage=e('<div id="qrr-loading-message">ðŸŽ¥ Unable to access video stream (please make sure you have a webcam enabled)</div>'),o.canvas=e('<canvas id="qrr-canvas" class="hidden"></canvas>'),o.audio=e('<audio hidden id="qrr-beep" src="'+e.qrCodeReader.beepPath+'" type="audio/mp3"></audio>'),o.outputDiv=e('<div id="qrr-output"></div>'),o.outputNoData=e('<div id="qrr-nodata">No QR code detected.</div>'),o.outputData=e('<div id="qrr-output-data"></div>'),o.outputNoData.appendTo(o.outputDiv),o.outputData.appendTo(o.outputDiv),o.loadingMessage.appendTo(o.container),o.canvas.appendTo(o.container),o.outputDiv.appendTo(o.container),o.audio.appendTo(o.container),o.okBtn.appendTo(o.container),o.bgOverlay.appendTo(a.body),o.bgOverlay.on("click",o.close),o.closeBtn.on("click",o.close),o.container.appendTo(a.body),o.video=a.createElement("video")},drawLine:function(e,t,a){var i=o.canvas[0].getContext("2d");i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.lineWidth=4,i.strokeStyle=a,i.stroke()},drawBox:function(e,t){o.drawLine(e.topLeftCorner,e.topRightCorner,t),o.drawLine(e.topRightCorner,e.bottomRightCorner,t),o.drawLine(e.bottomRightCorner,e.bottomLeftCorner,t),o.drawLine(e.bottomLeftCorner,e.topLeftCorner,t)},setOptions:function(t,a){var i={multiple:e(t).data("qrr-multiple"),qrcodeRegexp:new RegExp(e(t).data("qrr-qrcode-regexp")),audioFeedback:e(t).data("qrr-audio-feedback"),repeatTimeout:e(t).data("qrr-repeat-timeout"),target:e(t).data("qrr-target"),skipDuplicates:e(t).data("qrr-skip-duplicates"),lineColor:e(t).data("qrr-line-color"),callback:e(t).data("qrr-callback")};a=e.extend({},i,a);var o=e.extend({},e.qrCodeReader.defaults,a);e(t).data("qrr",o)},getOptions:function(t){o.settings=e(t).data("qrr")},open:function(){o.isOpen||(o.getOptions(this),o.bgOverlay.show(),o.container.slideDown(),o.codes=[],o.outputNoData.show(),o.outputData.empty(),o.outputData.hide(),o.settings.multiple?(o.okBtn.show(),o.okBtn.off("click").on("click",o.doneReading)):o.okBtn.hide(),e(a).on("keyup.qrCodeReader",(function(e){27===e.keyCode&&o.close(),o.settings.multiple&&13===e.keyCode&&o.doneReading()})),o.isOpen=!0,o.scriptLoaded&&o.start())},start:function(){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then((function(e){o.video.srcObject=e,o.video.setAttribute("playsinline",!0),o.video.play(),o.startReading()}))},startReading:function(){o.requestID=t.requestAnimationFrame(o.read)},doneReading:function(){var t=o.codes[0];if(o.settings.target){if(o.settings.multiple)t=o.codes.join("\n");e(o.settings.target).val(t)}if(o.settings.callback)try{o.settings.multiple?o.settings.callback(o.codes):o.settings.callback(t)}catch(e){console.error(e)}o.close()},read:function(){var t=!1,a=o.canvas[0].getContext("2d");if(o.loadingMessage.text("âŒ› Loading video..."),o.canvas.off("click.qrCodeReader",o.startReading),o.video.readyState===o.video.HAVE_ENOUGH_DATA){o.loadingMessage.hide(),o.canvas.removeClass("hidden"),o.canvas[0].height=o.video.videoHeight,o.canvas[0].width=o.video.videoWidth,a.drawImage(o.video,0,0,o.canvas[0].width,o.canvas[0].height);var i=a.getImageData(0,0,o.canvas[0].width,o.canvas[0].height),n=jsQR(i.data,i.width,i.height,{inversionAttempts:"dontInvert"});n&&o.settings.qrcodeRegexp.test(n.data)&&(o.drawBox(n.location,o.settings.lineColor),t=!0,o.codes.push(n.data),o.outputNoData.hide(),o.outputData.show(),o.settings.audioFeedback&&o.audio[0].play(),o.settings.multiple?(o.settings.skipDuplicates&&(o.codes=e.unique(o.codes)),e('<div class="qrr-input"></div>').text(n.data).appendTo(o.outputData),o.outputDiv[0].scrollTop=o.outputDiv[0].scrollHeight,o.canvas.on("click.qrCodeReader",o.startReading),o.settings.repeatTimeout>0?setTimeout(o.startReading,o.settings.repeatTimeout):(o.loadingMessage.text("Click on the image to read the next QRCode"),o.loadingMessage.show())):o.doneReading())}t||o.startReading()},close:function(){o.requestID&&t.cancelAnimationFrame(o.requestID),e(a).off("keyup.qrCodeReader"),o.video.srcObject&&o.video.srcObject.getTracks()[0].stop(),o.canvas.addClass("hidden"),o.loadingMessage.show(),o.bgOverlay.hide(),o.container.hide(),o.isOpen=!1}},e.fn.qrCodeReader=function(t){return e.qrCodeReader.instance||((o=new n).init(),e.qrCodeReader.instance=o),this.each((function(){o.setOptions(this,t),e(this).off("click.qrCodeReader").on("click.qrCodeReader",o.open)}))}}(jQuery,window,document);